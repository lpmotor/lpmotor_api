# Описание API для LPmotor.ru

Запросы к API выполняются в следующем формате:

    <адрес сервера>/api/v1/<метод>?<параметры>

(где `v1` указывает версию API)

API возвращает результат выполнения операции в JSON-формате.

Возможны следующие коды HTTP-статуса:

* `200` : запрос успешно выполнен
* `400` : неверный запрос (ошибка в переданных данных)
    * проверьте формат и набор входящих параметров
* `403` : доступ запрещен
    * проверьте правильность переданного ключа
    * возможно, передано неверное сочетание user_key и id объекта
* `404` : метод API не найден
    * проверьте правильность написания метода API и его версии
* `500` : ошибка на сервере
    * напишите нам, с указанием ошибки

Все запросы к API требуют указания ключа, который идентифицирует пользователя (user_key).
Чтобы получить этот ключ, нужно зарегистрировать пользователя с помощью метода __/user/signup__, который вернет сгенерированный user_key.

1. [Регистрация пользователя](https://github.com/nezdalida/lpmotor_api#user_reg)
1. [Список сайтов](https://github.com/nezdalida/lpmotor_api#site_list)

.

## <a name="user_reg"></a>1. Регистрация пользователя

    GET /user/signup

Регистрирует нового пользователя в системе.

Запрос нужно отправлять на сервер авторизации: _https://auth.lpmotor.ru_.

Входные параметры (все обязательны):

* `partner_key` (hash) ключ партнера, 32 символа (генерируется в LPmotor)
* `email` (string) почтовый ящик, который указывает ваш пользователь при регистрации

Выходные параметры:

* `status` (string) статус выполнения операции
* `user_key` (hash) ключ, идентицифирующий пользователя в системе
* `adm_id` (int) идентификатор сервера, к которому нужно делать запросы, относящиеся к конкретному пользователю

-

Пример:

    https://auth.lpmotor.ru/api/v1/auth/signup?partner_key=9d4f&email=test@mail.ru

Результат выполнения:

    HTTP/1.1 200 OK
    {"status":"ok", "user_key":"9d4f", "adm_id":"1"}

-

Возможные коды ошибок:

* `1111` : Пользователь с заданным E-mail уже зарегистрирован;
* `2222` : Партнер с заданным partner_key не найден;

.

## <a name="site_list">2. Получение списка сайтов

    GET /site/list

Возвращает данные о всех сайтах пользователя.

Запрос нужно отправлять на сервер данных: _https://adm[adm_id].lpmotor.ru_, где _[adm_id]_ - это идентификатор сервера, полученный при регистрации пользователя.

Входные параметры:

* `user_key` (hash) идентификатор пользователя

Выходные параметры:

* `status` (string) статус выполнения операции
* `list` (array) массив данных о сайтах

Каждый элемент массива __list__ имеет формат:

    {
        "id": 999, //идентификатор сайта
        "name": "Мой сайт", //название сайта
        "status": "off", //статус публикации
    }

-

Пример:

    https://adm1.lpmotor.ru/api/v1/site_list?user_key=9d4f

Результат выполнения:

    HTTP/1.1 200 OK
    {"status":"ok", "list":[]}

-

Возможные коды ошибок:

* `1111` : ;

.